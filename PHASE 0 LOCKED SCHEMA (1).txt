-- Existing Phase 0 Schema (profiles, items, interactions)

CREATE TABLE profiles (
  user_id UUID PRIMARY KEY,
  email TEXT NOT NULL,
  display_name TEXT,
  avatar_url TEXT,
  role TEXT,
  dob DATE,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE TABLE items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  kind TEXT NOT NULL,
  author_id UUID,
  author_email TEXT NOT NULL,
  visibility TEXT,
  body TEXT,
  media_urls TEXT[],
  parent_id UUID,
  start_at TIMESTAMPTZ,
  end_at TIMESTAMPTZ,
  data JSONB,
  is_deleted BOOLEAN,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE TABLE interactions (
  item_id UUID NOT NULL,
  user_email TEXT NOT NULL,
  type TEXT NOT NULL,
  answer_index INT,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- New Trivia Tables
CREATE TABLE quiz_questions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  question_text TEXT NOT NULL,
  options TEXT[] NOT NULL,
  order_index INT NOT NULL
);

CREATE TABLE quiz_answers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(user_id),
  question_id UUID REFERENCES quiz_questions(id),
  answer_index INT NOT NULL,
  locked_at TIMESTAMPTZ DEFAULT now()
);

CREATE TABLE quiz_guesses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  guesser_id UUID REFERENCES profiles(user_id),
  target_id UUID REFERENCES profiles(user_id),
  question_id UUID REFERENCES quiz_questions(id),
  guessed_index INT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- New Scenario Tables
CREATE TABLE scenario_questions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  question_text TEXT NOT NULL,
  options TEXT[] NOT NULL,
  correct_index INT NOT NULL,
  order_index INT NOT NULL
);

CREATE TABLE scenario_answers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(user_id),
  question_id UUID REFERENCES scenario_questions(id),
  chosen_index INT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now()
);
